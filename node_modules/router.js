var _ = require('underscore');

function Router() {
    var routes = [];
    
    var pageNotFound = {
        process: function(req, res) {
            res.statusCode = 404;
            res.end('Not found');
        }
    };
    
    return {
        addRoute: function(route) {
            if(route.url === undefined ||
                route.url === '')        {
                    throw new Error('Router: empty url was passed');
                }
            
            if(!_.isFunction(route.process)) {
                throw new Error('Router: not function was passed');
            }
            
            routes.push(route);
        },
        
        forward: function(req, res) {
            var route = pageNotFound;
            for(var i = 0; i < routes.length; i++) {
                if(routes[i].url === req.url)     route = routes[i];
            }
            
            route.process(req, res);
        },
        
        setPageNotFound: function(page) {
            pageNotFound = page;
        }
    };
    
}

var router = new Router();
require('../router_setup')(router);     //configure the router

module.exports = router;